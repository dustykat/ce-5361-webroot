
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Automated Data Retreival &#8212; Surface Water Hydrology</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet" />
  <link href="../../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"processClass": "tex2jax_process|mathjax_process|math|output_area"}})</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="7. Surface-Runoff Mechanics" href="../07runoffmechanisms/runoffmechanisms.html" />
    <link rel="prev" title="Streamflow Data Modeling" href="../06streamflow/streamflowdata.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/hydrology2.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Surface Water Hydrology</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../intro.html">
   Preface
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../01overview/overview.html">
   1. Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../02hydrocycle/hydrocycle.html">
   2. Hydrologic Cycle
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../03watersheds/watersheds.html">
   3. Watersheds
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../03watersheds/delineationbyhand.html">
     Delineation (by Hand)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03watersheds/delineationbyDEM.html">
     Delineation (Homebrew DEM)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03.1qgis/qgis.html">
     3.1 QGIS
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03watersheds/delineationbyGIS.html">
     Delineation (using GIS)
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../04precipitation/precipitation.html">
   4. Precipitation
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../04precipitation/pointprecipitation.html">
     Precipitation Modeling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04precipitation/arealrainfall.html">
     Precipitation over an Area
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../05.0abstractions/abstractions.html">
   5. Hydrologic Abstractions
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../05.1infiltration/infiltration.html">
     5.1 Infiltration
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05.1infiltration/gis-soils.html">
     GIS Soils Properties
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05.2evaporation/evaporation.html">
     5.2 Evapotranspiration
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05.3interception/interception.html">
     5.3 Interception/Depression Storage
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../06streamflow/streamflow.html">
   6. Streamflow
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="../06streamflow/streamflowdata.html">
     Streamflow Data Modeling
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Automated Data Retreival
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../07runoffmechanisms/runoffmechanisms.html">
   7. Surface-Runoff Mechanics
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../08hydrographs/hydrographs.html">
   8. Hydrographs
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../08hydrographs/1.baseflow.html">
     8.1 Baseflow Separation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../08hydrographs/2.unithydrographs.html">
     8.2 Unit Hydrographs
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../10data/data.html">
   10. Data Analysis
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../11.0hydrologicrouting/hydrologicrouting.html">
   11. Hydrologic Routing
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../11.1pulsrouting/pulsrouting.html">
     11.1 Channel Routing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../11.2reservoirrouting/reservoirrouting.html">
     11.2 Level Pool Routing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../11.3outletworks/outletworks.html">
     11.3 Outlet Control(s)
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../12.0rainfallrunoff/rainfallrunoff.html">
   12. Rainfall-Runoff Modeling
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../12.0rainfallrunoff/rationalmethod.html">
     12.1 Rational Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../12.0rainfallrunoff/linearreservoir.html">
     12.2 Linear Reservoir Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../12.0rainfallrunoff/CNmethod.html">
     12.3 NRCS CN model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../12.0rainfallrunoff/nonlinreservoir.html">
     12.4 Nonlinear Reservoir Model
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../13hechms/HMSintro.html">
   13. HEC-HMS Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../14swmm/swmm-intro.html">
   14. Introduction to SWMM
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../12morphology/morphology.html">
   River Morphology and Channel Dynamics
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../99Exams/exams.html">
   24. Exams
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../99Exams/EX1/EX1.html">
     <font color="darkblue">
      Exam 1
     </font>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../99Exams/EX1/src_sol/EX1-WS.html">
     <font color="darkblue">
      Solution Sketch Exam 1
     </font>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../99Exams/EX2/EX2.html">
     <font color="darkblue">
      Exam 2
     </font>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../99Exams/EX2/src_sol/EX2-WS.html">
     <font color="darkblue">
      Solution Sketch Exam 2
     </font>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../99Exams/EX3/EX3.html">
     <font color="darkblue">
      Exam 3
     </font>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../99Exams/EX3/src_sol/EX3-WS.html">
     <font color="darkblue">
      Solution Sketch Exam 3
     </font>
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../21watershedplanning/watershedplanning.html">
   Watershed Planning
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/lessons/06.1streamflow/automated_data.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/executablebooks/jupyter-book"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Flessons/06.1streamflow/automated_data.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/docs/lessons/06.1streamflow/automated_data.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-hydrological-data-analysis-and-visualization-toolkit">
   A Hydrological Data Analysis and Visualization Toolkit
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#streamflow-data-retrieval">
     STREAMFLOW DATA RETRIEVAL
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#statistics-histogram-and-flow-duration-curve">
   STATISTICS, HISTOGRAM AND FLOW DURATION CURVE
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#temporal-pattern">
   TEMPORAL PATTERN
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#rating-curve">
   Rating Curve
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#outputs">
     Outputs:
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#functions">
     Functions:
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#libraries-used">
     Libraries Used:
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#references">
     References
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="automated-data-retreival">
<h1>Automated Data Retreival<a class="headerlink" href="#automated-data-retreival" title="Permalink to this headline">¶</a></h1>
<p>The semi-automatic retrieval of data is valuable for documenting and reconstructing work related to hydrology.  What follows is scripting by a colleague that can be used for future efforts.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>I have modified his original work to render on my web server - main changes are to suppress interactive behavior, and to split the code up a bit.  Otherwise it is Moise’s original Thesis work unchanged!</p>
</div>
<div class="section" id="a-hydrological-data-analysis-and-visualization-toolkit">
<h2>A Hydrological Data Analysis and Visualization Toolkit<a class="headerlink" href="#a-hydrological-data-analysis-and-visualization-toolkit" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><em>Author</em>: Moise Baraka, Ph.D. Student in CECE Water Resources, Texas Tech University</p></li>
<li><p><em>Date</em>: 02/21/2024</p></li>
<li><p><em>Supervised by</em> Theodore Cleveland, Ph.D. CECE Water Resources, Associate Professor, Texas Tech University</p></li>
<li><p><em>class of</em> spring 2024 in Surface Water Hydrology</p></li>
<li><p>Description:
<em>This toolkit provides a collection of functions for retrieving, processing, analyzing, and visualizing hydrological data from the USGS web server. It includes modules for retrieving rating curve data, fitting it, computing statistical measures, generating histograms, and plotting various hydrological data attributes. The program allows users to input station codes to retrieve specific data and provides visualizations for any station monitored by the USGS program.</em></p></li>
</ul>
<hr class="docutils" />
<div class="section" id="streamflow-data-retrieval">
<h3>STREAMFLOW DATA RETRIEVAL<a class="headerlink" href="#streamflow-data-retrieval" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><strong>Step 1: Input Collection</strong></p></li>
</ul>
<p>The script prompts the user to input the USGS station ID, start date, and end date.</p>
<ul class="simple">
<li><p><strong>Step 2: Directory Selection</strong></p></li>
</ul>
<p>The user is prompted to input the directory where the data will be saved. If no directory is provided, it defaults to a predefined directory, which must have been defined in the script.</p>
<ul class="simple">
<li><p><strong>Step 3: URL Construction</strong></p></li>
</ul>
<p>The script constructs a URL using the provided station ID, start date, and end date. This URL is used to retrieve the data from the USGS website.</p>
<ul class="simple">
<li><p><strong>Step 4: Data Retrieval</strong></p></li>
</ul>
<p>The script downloads the data from the constructed URL. During the download process, it displays a progress bar or percentage showing the download progress.</p>
<ul class="simple">
<li><p><strong>Step 5: Data Saving</strong></p></li>
</ul>
<p>The downloaded data is saved to the specified directory with a filename indicating the station code and data type.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Here we load required modules</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">urllib.request</span>
<span class="kn">import</span> <span class="nn">tqdm</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">os</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Date parser function.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#------------------------------------------------------------------------</span>
<span class="k">def</span> <span class="nf">get_date_input</span><span class="p">(</span><span class="n">prompt</span><span class="p">):</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">date_input</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span>
        <span class="c1"># Validate date format</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^\d</span><span class="si">{4}</span><span class="s1">-\d</span><span class="si">{2}</span><span class="s1">-\d</span><span class="si">{2}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="n">date_input</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">date_input</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Invalid date format. Please use yyyy-mm-dd format.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Directory selector function</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#------------------------------------------------------------------------</span>
<span class="k">def</span> <span class="nf">get_save_directory_input</span><span class="p">(</span><span class="n">default_directory</span><span class="p">):</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">save_directory</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Enter the directory to save the data (press Enter to use default directory </span><span class="si">{</span><span class="n">default_directory</span><span class="si">}</span><span class="s2">): &quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">save_directory</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">default_directory</span>
        <span class="c1"># Validate directory exists</span>
        <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">save_directory</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">save_directory</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Directory does not exist. Please enter a valid directory.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Here we build the URL to generate the request to USGS server(s)</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#------------------------------------------------------------------------</span>
<span class="k">def</span> <span class="nf">build_url1</span><span class="p">(</span><span class="n">station_code</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">):</span>
    <span class="n">base_url</span> <span class="o">=</span> <span class="s1">&#39;https://nwis.waterdata.usgs.gov/nwis/dv?referred_module=sw&amp;search_site_no=&#39;</span>
    <span class="n">query_params</span> <span class="o">=</span> <span class="s1">&#39;&amp;search_site_no_match_type=exact&amp;site_tp_cd=OC&amp;site_tp_cd=OC-CO&amp;site_tp_cd=ES&amp;site_tp_cd=&#39;</span> \
                   <span class="s1">&#39;LK&amp;site_tp_cd=ST&amp;site_tp_cd=ST-CA&amp;site_tp_cd=ST-DCH&amp;site_tp_cd=ST-TS&amp;index_pmcode_00060=1&#39;</span> \
                   <span class="s1">&#39;&amp;group_key=NONE&amp;sitefile_output_format=html_table&amp;column_name=agency_cd&amp;column_name=site_no&#39;</span> \
                   <span class="s1">&#39;&amp;column_name=station_nm&amp;range_selection=date_range&amp;begin_date=&#39;</span> <span class="o">+</span> <span class="n">start_date</span> <span class="o">+</span> <span class="s1">&#39;&amp;end_date=&#39;</span> <span class="o">+</span> <span class="n">end_date</span> <span class="o">+</span> \
                   <span class="s1">&#39;&amp;format=rdb&amp;date_format=YYYY-MM-DD&amp;rdb_compression=value&amp;list_of_search_criteria=search_site_no%2Csite_tp_cd%2Crealtime_parameter_selection&#39;</span>

    <span class="k">return</span> <span class="n">base_url</span> <span class="o">+</span> <span class="n">station_code</span> <span class="o">+</span> <span class="n">query_params</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Now the retreival step.  Some output is suppressed for JupyterBook</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#------------------------------------------------------------------------</span>
<span class="c1"># Retrieve and save data from a URL, and return the filename</span>
<span class="k">def</span> <span class="nf">retrieve_and_save_data</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Downloading data from:&quot;</span><span class="p">,</span> <span class="n">url</span> <span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">total_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;content-length&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">downloaded</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">chunk_size</span> <span class="o">=</span> <span class="mi">1024</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>  <span class="c1"># Record start time</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">chunk</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">chunk_size</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">chunk</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
            <span class="n">downloaded</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">total_size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">progress</span> <span class="o">=</span> <span class="n">downloaded</span> <span class="o">/</span> <span class="n">total_size</span> <span class="o">*</span> <span class="mi">100</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Assume 1.2 seconds download time if total_size is zero</span>
                <span class="n">elapsed_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
                <span class="n">progress</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">elapsed_time</span> <span class="o">/</span> <span class="mf">1.2</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
<span class="c1">#            print(f&quot;Estimated downloading progress: {progress:.1f}%\r&quot;, end=&#39;&#39;) </span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Data saved to:&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">filename</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Here is the batch request (deactivate for interactive)</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">station_code</span> <span class="o">=</span> <span class="s1">&#39;07297910&#39;</span>
<span class="n">start_date</span> <span class="o">=</span> <span class="s1">&#39;1936-01-01&#39;</span>
<span class="n">end_date</span> <span class="o">=</span> <span class="s1">&#39;2024-02-01&#39;</span>
<span class="n">save_directory</span> <span class="o">=</span> <span class="s1">&#39;./&#39;</span> <span class="c1"># suppress and actiovate above for interactive</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Here is the interactive part (activate for interactive)</p>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#--------------------------------------------------------------------------</span>
<span class="c1">#                          Define the inputs</span>
<span class="c1">#--------------------------------------------------------------------------</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ------------------------------------------&quot;</span><span class="p">,</span>
        <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Please provide the following information:&quot;</span><span class="p">,</span>
        <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> ------------------------------------------&quot;</span><span class="p">)</span>


<span class="c1"># activate code below and suppress above 3 lines for interactive</span>
<span class="c1">#station_code = input(&#39;- USGS station ID: &#39;)</span>
<span class="c1">#start_date = get_date_input(&#39;- Start Date (yyyy-mm-dd): &#39;)</span>
<span class="c1">#end_date = get_date_input(&#39;- End Date (yyyy-mm-dd): &#39;)</span>



<span class="c1">#--------- !!! Define the directory where the data will be saved !!! -----------</span>
<span class="n">default_directory</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;C:\Users\mbaraka\OneDrive - Texas Tech University\Thesis file&quot;</span>  <span class="c1"># To be defined!</span>

<span class="n">save_directory</span> <span class="o">=</span> <span class="n">get_save_directory_input</span><span class="p">(</span><span class="n">default_directory</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Here get the file from the remote</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#--------------------------------------------------------------------------</span>
<span class="c1">#        Define the base URLs for data retrieval from Website 1</span>
<span class="c1">#--------------------------------------------------------------------------</span>
<span class="n">url1</span> <span class="o">=</span> <span class="n">build_url1</span><span class="p">(</span><span class="n">station_code</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">)</span>

<span class="c1"># Retrieve and save data from Website 1</span>
<span class="n">filename1</span> <span class="o">=</span> <span class="n">retrieve_and_save_data</span><span class="p">(</span><span class="n">url1</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_directory</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;USGS_Data_for_</span><span class="si">{</span><span class="n">station_code</span><span class="si">}</span><span class="s1">.txt&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading data from: https://nwis.waterdata.usgs.gov/nwis/dv?referred_module=sw&amp;search_site_no=07297910&amp;search_site_no_match_type=exact&amp;site_tp_cd=OC&amp;site_tp_cd=OC-CO&amp;site_tp_cd=ES&amp;site_tp_cd=LK&amp;site_tp_cd=ST&amp;site_tp_cd=ST-CA&amp;site_tp_cd=ST-DCH&amp;site_tp_cd=ST-TS&amp;index_pmcode_00060=1&amp;group_key=NONE&amp;sitefile_output_format=html_table&amp;column_name=agency_cd&amp;column_name=site_no&amp;column_name=station_nm&amp;range_selection=date_range&amp;begin_date=1936-01-01&amp;end_date=2024-02-01&amp;format=rdb&amp;date_format=YYYY-MM-DD&amp;rdb_compression=value&amp;list_of_search_criteria=search_site_no%2Csite_tp_cd%2Crealtime_parameter_selection 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Data saved to: ./USGS_Data_for_07297910.txt
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="statistics-histogram-and-flow-duration-curve">
<h2>STATISTICS, HISTOGRAM AND FLOW DURATION CURVE<a class="headerlink" href="#statistics-histogram-and-flow-duration-curve" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><strong>Data Processing:</strong></p></li>
</ul>
<p>To begin with, the script processes text data saved previously, creating a DataFrame. It extracts relevant information such as agency code, site number, datetime, flow rate, and flag.</p>
<ul class="simple">
<li><p><strong>Statistical Analysis:</strong></p></li>
</ul>
<p>The script performs statistical analysis on the flow rate data, calculating various metrics like median, mean, standard deviation, variance, minimum, maximum, quartiles, and interquartile range. It identifies and counts outliers based on the interquartile range method.</p>
<ul class="simple">
<li><p><strong>Plotting:</strong></p></li>
</ul>
<p>The script plots two types of graphs:</p>
<ol class="simple">
<li><p>Flow Frequency Histogram with KDE (Kernel Density Estimation):</p></li>
</ol>
<p>Plots the distribution of flow rates against frequency. Uses Kernel Density Estimation (KDE) for smooth estimation of the probability density function.</p>
<div class="math notranslate nohighlight">
\[ P(x) = \frac{1}{n h} \sum_{i=1}^{n} K\left(\frac{x-x_i}{h}\right) \]</div>
<p>where <span class="math notranslate nohighlight">\(P(x)\)</span> is the density estimate at point <span class="math notranslate nohighlight">\(x\)</span>, <span class="math notranslate nohighlight">\(n\)</span> is the number of data points, <span class="math notranslate nohighlight">\(h\)</span> is the bandwidth, <span class="math notranslate nohighlight">\(x_i\)</span> are the data points, and <span class="math notranslate nohighlight">\(K\)</span> is the kernel function.</p>
<ol class="simple">
<li><p>Flow Duration Curve (FDC) with Weibull formula and legend:</p></li>
</ol>
<p>Plots the flow rate against the probability of exceedance or equality. Computes the cumulative probability using the Gringorten method, a generalized version of the Weibull formula, defined as follows:
$<span class="math notranslate nohighlight">\( P(X \geq x) = \left(1 - \left(\frac{i-0.4}{n+0.2}\right)\right) \times 100 \)</span>$</p>
<p>where <span class="math notranslate nohighlight">\(P(X \geq x)\)</span> is the cumulative probability of exceeding or equaling <span class="math notranslate nohighlight">\(x\)</span>, <span class="math notranslate nohighlight">\(i\)</span> is the rank of the data point, and <span class="math notranslate nohighlight">\(n\)</span> is the total number of data points.</p>
<p><em>Note: Both plots are customized with appropriate labels, titles, gridlines, and legends.</em></p>
<ul class="simple">
<li><p><strong>Outputs:</strong></p></li>
</ul>
<p>The script generates CSV files containing processed data and statistical analysis results. It also saves PNG images of the flow frequency histogram and flow duration curve.</p>
<ul class="simple">
<li><p><strong>Libraries Used:</strong></p>
<ol class="simple">
<li><p>pandas: For data manipulation and analysis.</p></li>
<li><p>numpy: For mathematical operations.</p></li>
<li><p>matplotlib.pyplot: For plotting graphs.</p></li>
<li><p>seaborn: For enhanced data visualization.</p></li>
<li><p>io: For handling file I/O operations.</p></li>
</ol>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Load the modules (libraries)</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">io</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Function to process the download data and build a pandas dataframe.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#------------------------------------------------------------------------</span>
<span class="c1"># Process data from a text file and return a cleaned DataFrame for Website 1</span>
<span class="k">def</span> <span class="nf">process_website1_data</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">station_code</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;USGS&quot;</span><span class="p">):</span>
                <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">agency_cd</span><span class="p">,</span> <span class="n">site_no</span><span class="p">,</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">flow_rate</span><span class="p">,</span> <span class="n">flag</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
                <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">agency_cd</span><span class="p">,</span> <span class="n">site_no</span><span class="p">,</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">flow_rate</span><span class="p">,</span> <span class="n">flag</span><span class="p">])</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;agency_cd&#39;</span><span class="p">,</span> <span class="s1">&#39;site_no&#39;</span><span class="p">,</span> <span class="s1">&#39;datetime&#39;</span><span class="p">,</span> <span class="s1">&#39;flow_rate&#39;</span><span class="p">,</span> <span class="s1">&#39;flag&#39;</span><span class="p">])</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;datetime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;datetime&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;flow_rate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;flow_rate&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;datetime&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="c1"># Filter and keep rows where &#39;flag&#39; is not equal to &quot;P&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;flag&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;P</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]</span>
    
    <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;flow_rate&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">csv_filename1</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_directory</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">station_code</span><span class="si">}</span><span class="s1">_flow_data.csv&#39;</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">csv_filename1</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">df</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Function to analyze the pandas dataframe, report relevant statistics, and save the results to a CSV file</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#------------------------------------------------------------------------</span>
<span class="k">def</span> <span class="nf">analyze_data</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Performs statistical analysis on the flow rate data and saves the results to a CSV file.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    df (DataFrame): DataFrame containing flow rate data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sample_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="n">median</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;flow_rate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
    <span class="n">mean</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;flow_rate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">std</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;flow_rate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
    <span class="n">variance</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;flow_rate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">var</span><span class="p">()</span>
    <span class="n">minimum</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;flow_rate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">maximum</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;flow_rate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">first_quartile</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;flow_rate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
    <span class="n">third_quartile</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;flow_rate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.75</span><span class="p">)</span>
    <span class="n">interquartile_range</span> <span class="o">=</span> <span class="n">third_quartile</span> <span class="o">-</span> <span class="n">first_quartile</span>
    
    <span class="c1"># Calculate number of outliers</span>
    <span class="n">outliers</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;flow_rate&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">first_quartile</span> <span class="o">-</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">interquartile_range</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;flow_rate&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">third_quartile</span> <span class="o">+</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">interquartile_range</span><span class="p">)]</span>
    <span class="n">num_outliers</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">outliers</span><span class="p">)</span>

    <span class="c1"># Display statistics</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--------- Statistics: ----------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;-  Sample Size: </span><span class="si">{</span><span class="n">sample_size</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;-  Median: </span><span class="si">{</span><span class="n">median</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;-  Mean: </span><span class="si">{</span><span class="n">mean</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;-  Standard Deviation: </span><span class="si">{</span><span class="n">std</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;-  Variance: </span><span class="si">{</span><span class="n">variance</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;-  Minimum: </span><span class="si">{</span><span class="n">minimum</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;-  Maximum: </span><span class="si">{</span><span class="n">maximum</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;-  First Quartile: </span><span class="si">{</span><span class="n">first_quartile</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;-  Third Quartile: </span><span class="si">{</span><span class="n">third_quartile</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;-  Interquartile Range: </span><span class="si">{</span><span class="n">interquartile_range</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;-  Number of Outliers: </span><span class="si">{</span><span class="n">num_outliers</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>
    
    <span class="c1"># Create DataFrame for statistics</span>
    <span class="n">statistics_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s1">&#39;Statistic&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Sample Size&#39;</span><span class="p">,</span> <span class="s1">&#39;Median&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean&#39;</span><span class="p">,</span> <span class="s1">&#39;Standard Deviation&#39;</span><span class="p">,</span> <span class="s1">&#39;Variance&#39;</span><span class="p">,</span> <span class="s1">&#39;Minimum&#39;</span><span class="p">,</span> <span class="s1">&#39;Maximum&#39;</span><span class="p">,</span> <span class="s1">&#39;First Quartile&#39;</span><span class="p">,</span> <span class="s1">&#39;Third Quartile&#39;</span><span class="p">,</span> <span class="s1">&#39;Interquartile Range&#39;</span><span class="p">,</span> <span class="s1">&#39;Number of Outliers&#39;</span><span class="p">],</span>
        <span class="s1">&#39;Value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">sample_size</span><span class="p">,</span> <span class="n">median</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">std</span><span class="p">,</span> <span class="n">variance</span><span class="p">,</span> <span class="n">minimum</span><span class="p">,</span> <span class="n">maximum</span><span class="p">,</span> <span class="n">first_quartile</span><span class="p">,</span> <span class="n">third_quartile</span><span class="p">,</span> <span class="n">interquartile_range</span><span class="p">,</span> <span class="n">num_outliers</span><span class="p">]</span>
    <span class="p">})</span>

    <span class="c1"># Save statistics to CSV file</span>
    <span class="n">statistics_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_directory</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">station_code</span><span class="si">}</span><span class="s1">_statistics.csv&#39;</span><span class="p">)</span>
    <span class="n">statistics_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">statistics_filename</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Function to plot a flow frequency diagram from the dataframe.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#------------------------------------------------------------------------</span>
<span class="k">def</span> <span class="nf">plot_flow_frequency_histogram</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots the flow frequency histogram with a fitted KDE based on the flow rates in the DataFrame.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    df (DataFrame): DataFrame containing flow rate data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;flow_rate&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
    <span class="n">kde_color</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span>
    <span class="n">kde_alpha</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">get_lines</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">kde_color</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">get_lines</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="n">kde_alpha</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Flow Frequency Histogram&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Flow Rate (cfs)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>  <span class="c1"># Ensure tight layout to prevent cropping of labels</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_directory</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">station_code</span><span class="si">}</span><span class="s1">_flow_frequency_histogram.png&#39;</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Function to plot a flow duration curve from the dataframe.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#------------------------------------------------------------------------</span>
<span class="k">def</span> <span class="nf">plot_flow_duration_curve</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots the flow duration curve (FDC).</span>

<span class="sd">    Parameters:</span>
<span class="sd">    df (DataFrame): DataFrame containing flow rate data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Sort the flow rates in descending order</span>
    <span class="n">df_sorted</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;flow_rate&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Compute the cumulative probability</span>
    <span class="c1"># The generalized form proposed by Gringorten (1963) a = 0.4</span>
    <span class="n">df_sorted</span><span class="p">[</span><span class="s1">&#39;cumulative_probability&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_sorted</span><span class="p">))</span><span class="o">+</span><span class="mf">0.6</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_sorted</span><span class="p">)</span><span class="o">+</span><span class="mf">1.2</span><span class="p">))</span> <span class="o">*</span> <span class="mi">100</span>

    <span class="c1"># Plot the flow duration curve</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">df_sorted</span><span class="p">[</span><span class="s1">&#39;cumulative_probability&#39;</span><span class="p">],</span> <span class="n">df_sorted</span><span class="p">[</span><span class="s1">&#39;flow_rate&#39;</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Flow Duration Curve&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Probability of exceedance or equality (\%)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Flow Rate ($ft^3/s$)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">)</span>

    <span class="c1"># Add legend with the Weibull formula</span>
    <span class="n">equation</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$P(X \geq x) = \left(1 - \left(\frac{i-0.4}{n+0.2}\right)\right) \times 100$&#39;</span>
    <span class="c1">#ax.legend([&#39;Flow Duration Curve&#39;, f&#39;Weibull Fit: {equation}&#39;], bbox_to_anchor=(0.35, .95), loc=&#39;upper left&#39;, fontsize=16)</span>

    <span class="c1"># Add text box with the Weibull formula</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Weilbull formula: </span><span class="si">{</span><span class="n">equation</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>  <span class="c1"># Ensure tight layout to prevent cropping of labels</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_directory</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">station_code</span><span class="si">}</span><span class="s1">_fdc.png&#39;</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Pocess the download data, build a pandas dataframe; then plot the flood frequency histogram, report summary statistics, and plot the flow duration curve.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#--------------------------------------------------------------------------</span>
<span class="c1">#      Preprocess the Retrieved Data and Display the Head Part of it </span>
<span class="c1">#--------------------------------------------------------------------------</span>
<span class="n">df1</span> <span class="o">=</span> <span class="n">process_website1_data</span><span class="p">(</span><span class="n">filename1</span><span class="p">,</span> <span class="n">station_code</span><span class="p">)</span>

<span class="c1"># Display the first few rows of data from Website 1</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Data from Website 1:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df1</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>

<span class="c1">#--------------------------------------------------------------------------</span>
<span class="c1">#                                 Plotting </span>
<span class="c1">#--------------------------------------------------------------------------</span>
<span class="c1"># Plot the flow frequency histogram with a fitted KDE</span>
<span class="n">plot_flow_frequency_histogram</span><span class="p">(</span><span class="n">df1</span><span class="p">)</span>

<span class="c1"># Statistical analysis</span>
<span class="n">analyze_data</span><span class="p">(</span><span class="n">df1</span><span class="p">)</span>

<span class="c1"># Flow duration curve</span>
<span class="n">plot_flow_duration_curve</span><span class="p">(</span><span class="n">df1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Data from Website 1:
           agency_cd   site_no  flow_rate flag
datetime                                      
1967-10-01      USGS  07297910        0.1    A
1967-10-02      USGS  07297910        0.1    A
1967-10-03      USGS  07297910        0.1    A
1967-10-04      USGS  07297910        0.1    A
1967-10-05      USGS  07297910        0.1    A
</pre></div>
</div>
<img alt="../../_images/automated_data_31_1.png" src="../../_images/automated_data_31_1.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>--------- Statistics: ----------

-  Sample Size: 20578
-  Median: 3.80
-  Mean: 26.72
-  Standard Deviation: 257.99
-  Variance: 66560.94
-  Minimum: 0.00
-  Maximum: 22700.00
-  First Quartile: 0.80
-  Third Quartile: 11.00
-  Interquartile Range: 10.20
-  Number of Outliers: 2038
</pre></div>
</div>
<img alt="../../_images/automated_data_31_3.png" src="../../_images/automated_data_31_3.png" />
</div>
</div>
</div>
<div class="section" id="temporal-pattern">
<h2>TEMPORAL PATTERN<a class="headerlink" href="#temporal-pattern" title="Permalink to this headline">¶</a></h2>
<p><strong>Data Processing:</strong></p>
<p>After plotting the rating curve, a script is written to process flow rate data stored in the DataFrame generated from the previous step. It calculates yearly means with standard deviations. It also performs linear regression to fit trend lines to the data.</p>
<p><strong>Plotting:</strong></p>
<p>Two types of plots are generated:</p>
<ol class="simple">
<li><p>Yearly Moving Averages: Plots the yearly moving averages of flow rate data with error bars representing standard deviations.</p></li>
<li><p>A Trend Line (Linear Regression): Fits a trend line to the yearly means using linear regression. The equation of the trend line is of the form: $<span class="math notranslate nohighlight">\( y = mx + c \)</span>$</p></li>
</ol>
<p>where <span class="math notranslate nohighlight">\(m\)</span> is the slope (coefficient), <span class="math notranslate nohighlight">\(x\)</span> is the year, and <span class="math notranslate nohighlight">\(c\)</span> is the intercept.</p>
<ol class="simple">
<li><p>Confidence Intervals: Calculates the 95% confidence interval for the trend line using the t-distribution. The formula for the margin of error is: $<span class="math notranslate nohighlight">\( E = t \times \frac{s}{\sqrt{n}} \)</span>$</p></li>
</ol>
<p>where <span class="math notranslate nohighlight">\(E\)</span> is the margin of error, <span class="math notranslate nohighlight">\(t\)</span> is the critical t-value, <span class="math notranslate nohighlight">\(s\)</span> is the standard deviation of the sample means, and <span class="math notranslate nohighlight">\(n\)</span> is the sample size.</p>
<p><strong>Outputs:</strong></p>
<p>The script generates two plots: daily flow rates and yearly means with trend lines and confidence intervals. Then the script saves the plot of yearly means as a PNG image.</p>
<p><strong>Libraries Used:</strong></p>
<ol class="simple">
<li><p>numpy: For mathematical operations.</p></li>
<li><p>matplotlib.pyplot: For plotting graphs.</p></li>
<li><p>scipy.stats.t: For computing t-values for confidence intervals.</p></li>
<li><p>sklearn.linear_model.LinearRegression: For performing linear regression.
linear regression.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">t</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>

<span class="c1">#------------------------------------------------------------------------</span>
<span class="k">def</span> <span class="nf">plot_yearly_moving_average</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots the yearly moving averages of flow rate data along with a trend line.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    df (DataFrame): DataFrame containing flow rate data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Compute yearly moving averages</span>
    <span class="n">yearly_ma</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;flow_rate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">365</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    
    <span class="c1"># Plot data and moving averages</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;flow_rate&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Flow Rate&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">yearly_ma</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">yearly_ma</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Yearly Moving Average&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
    
    <span class="c1"># Fit a trend line</span>
    <span class="n">trend_coef</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_julian_date</span><span class="p">(),</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;flow_rate&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">trend_line</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">trend_coef</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">trend_line</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_julian_date</span><span class="p">()),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Trend Line&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Yearly Moving Averages of Flow Rate with Trend Line&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Date (years)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Flow Rate ($ft^3/s$)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1">#------------------------------------------------------------------------</span>
<span class="k">def</span> <span class="nf">plot_yearly_means_with_trend</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots the yearly means of flow rate data with error bars (std) and a trend line with shaded confidence intervals.</span>
<span class="sd">    NaN values in flow rate are replaced by the mean of all non-NaN flow rates,</span>
<span class="sd">    and NaN values in standard deviation are replaced by the mean of all non-NaN standard deviations.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    df (DataFrame): DataFrame containing flow rate data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Compute yearly means and standard deviations</span>
    <span class="n">yearly_means</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;flow_rate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">yearly_std</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;flow_rate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

    <span class="c1"># Replace NaN values in flow rate with the mean of all non-NaN flow rates</span>
    <span class="n">yearly_means</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">yearly_means</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="c1"># Replace NaN values in std with the mean of all non-NaN std</span>
    <span class="n">yearly_std</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">yearly_std</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="c1"># Prepare data for linear regression</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">yearly_means</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">yearly_means</span><span class="o">.</span><span class="n">values</span>
    
    <span class="c1"># Fit linear regression model</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    
    <span class="c1"># Compute trend line values</span>
    <span class="n">trend_values</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    
    <span class="c1"># Compute overall mean and standard deviation of yearly means</span>
    <span class="n">overall_mean</span> <span class="o">=</span> <span class="n">yearly_means</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">overall_std</span> <span class="o">=</span> <span class="n">yearly_means</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
    
    <span class="c1"># Compute t-value for a 95% confidence interval with n-1 degrees of freedom</span>
    <span class="n">t_value</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">0.975</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">yearly_means</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    
    <span class="c1"># Compute margin of error</span>
    <span class="n">margin_of_error</span> <span class="o">=</span> <span class="n">t_value</span> <span class="o">*</span> <span class="n">overall_std</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">yearly_means</span><span class="p">))</span>
    
    <span class="c1"># Compute upper and lower bounds of the confidence interval for the overall mean</span>
    <span class="n">upper_bound</span> <span class="o">=</span> <span class="n">trend_values</span> <span class="o">+</span> <span class="n">margin_of_error</span>
    <span class="n">lower_bound</span> <span class="o">=</span> <span class="n">trend_values</span> <span class="o">-</span> <span class="n">margin_of_error</span>
    
    <span class="c1"># Plot yearly means with error bars</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">yearly_means</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">yearly_means</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">yearly_std</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Yearly Means ± Std&#39;</span><span class="p">)</span>
    
    <span class="c1"># Plot trend line</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">yearly_means</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">trend_values</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Trend Line: $y = </span><span class="si">{</span><span class="n">model</span><span class="o">.</span><span class="n">coef_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">x + (</span><span class="si">{</span><span class="n">model</span><span class="o">.</span><span class="n">intercept_</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">)$&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
    
    <span class="c1"># Shade confidence interval</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">yearly_means</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">lower_bound</span><span class="p">,</span> <span class="n">upper_bound</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;95\% Confidence Interval&#39;</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Yearly Means of Flow Rate with Trend Line and Confidence Intervals&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Date $(yrs)$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Flow Rate $(ft^3/s)$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>  <span class="c1"># Ensure tight layout to prevent cropping of labels</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_directory</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">station_code</span><span class="si">}</span><span class="s1">_yearly_mean.png&#39;</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="c1">#yearly_means</span>

<span class="c1">#------------------------------------------------------------------------</span>
<span class="c1">#                         Moving average </span>
<span class="c1">#------------------------------------------------------------------------</span>
<span class="n">plot_yearly_moving_average</span><span class="p">(</span><span class="n">df1</span><span class="p">)</span>
<span class="n">plot_yearly_means_with_trend</span><span class="p">(</span><span class="n">df1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/automated_data_33_0.png" src="../../_images/automated_data_33_0.png" />
<img alt="../../_images/automated_data_33_1.png" src="../../_images/automated_data_33_1.png" />
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="rating-curve">
<h2>Rating Curve<a class="headerlink" href="#rating-curve" title="Permalink to this headline">¶</a></h2>
<p>Based on the station code, the script retrieves rating curve data from the USGS website using the station code provided as input. It then fits a rating curve equation of the form <span class="math notranslate nohighlight">\(H(Q) = a \cdot Q^b + \frac{1}{c}\)</span> to the data, where <span class="math notranslate nohighlight">\(H\)</span> is gage height and <span class="math notranslate nohighlight">\(Q\)</span> is discharge. The fitting is performed by minimizing the residuals between the observed and predicted gage heights. The R-squared value is computed as a measure of goodness-of-fit.</p>
<div class="section" id="outputs">
<h3>Outputs:<a class="headerlink" href="#outputs" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Plot of the original rating curve data.</p></li>
<li><p>Plot of the fitted rating curve along with the equation and R-squared value.</p></li>
<li><p>If successful, the script also saves the fitted curve plot as a PNG file.</p></li>
</ul>
</div>
<div class="section" id="functions">
<h3>Functions:<a class="headerlink" href="#functions" title="Permalink to this headline">¶</a></h3>
<ol class="simple">
<li><p>retrieve_rating_curve_data(station_code): Retrieves and cleans rating curve data from the USGS website.</p></li>
<li><p>plot_original_data(df_rating): Plots the original rating curve data.</p></li>
<li><p>objective_function(params, df_rating, equation_func): Objective function to minimize residuals and maximize R-squared.</p></li>
<li><p>fit_rating_curve(df_rating): Fits the rating curve equation to the data using optimization.</p></li>
<li><p>plot_fitted_curve(df_rating, params, r_squared): Plots the fitted rating curve along with the equation and R-squared value.</p></li>
<li><p>main(station_code): Main function to execute the entire process.</p></li>
</ol>
</div>
<div class="section" id="libraries-used">
<h3>Libraries Used:<a class="headerlink" href="#libraries-used" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>numpy: For mathematical operations.</p></li>
<li><p>pandas: For data manipulation.</p></li>
<li><p>matplotlib.pyplot: For plotting graphs.</p></li>
<li><p>scipy.optimize.minimize: For optimization to fit the curve.</p></li>
<li><p>sklearn.metrics.r2_score: For computing the R-squared value.</p></li>
<li><p>requests: For retrieving data from the USGS website.
om the USGS website.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Import Libaries</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">minimize</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">r2_score</span>
<span class="kn">import</span> <span class="nn">requests</span> 
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Rating equation structure is a power-law model; fitted values are <span class="math notranslate nohighlight">\(a\)</span>,<span class="math notranslate nohighlight">\(b\)</span>, and <span class="math notranslate nohighlight">\(c\)</span></p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define the equation a * Q^b + c</span>
<span class="k">def</span> <span class="nf">rating_equation</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="n">c</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Retreive rating curve from original database - not are downloading again, so still need the mighty Internet to work!</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Retrieve rating curve data</span>
<span class="k">def</span> <span class="nf">retrieve_rating_curve_data</span><span class="p">(</span><span class="n">station_code</span><span class="p">):</span>
    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://waterdata.usgs.gov/nwisweb/get_ratings?file_type=exsa&amp;site_no=</span><span class="si">{</span><span class="n">station_code</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to retrieve data for station code </span><span class="si">{</span><span class="n">station_code</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">29</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;INDEP&quot;</span><span class="p">,</span> <span class="s2">&quot;SHIFT&quot;</span><span class="p">,</span> <span class="s2">&quot;DEP&quot;</span><span class="p">,</span> <span class="s2">&quot;STOR&quot;</span><span class="p">])</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s2">&quot;INDEP&quot;</span><span class="p">,</span> <span class="s2">&quot;DEP&quot;</span><span class="p">]]</span>
    <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Gage Height&quot;</span><span class="p">,</span> <span class="s2">&quot;Discharge&quot;</span><span class="p">]</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Gage Height&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Gage Height&quot;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Discharge&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Discharge&quot;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;Discharge&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Plot the rating cruve</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the original rating curve data</span>
<span class="k">def</span> <span class="nf">plot_original_data</span><span class="p">(</span><span class="n">df_rating</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df_rating</span><span class="p">[</span><span class="s1">&#39;Discharge&#39;</span><span class="p">],</span> <span class="n">df_rating</span><span class="p">[</span><span class="s1">&#39;Gage Height&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Original data&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;steelblue&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Discharge $(ft^3/s)$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Gage Height $(ft)$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Original Rating Curve Data&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>An obective function to be minimized to recover <span class="math notranslate nohighlight">\(a\)</span>,<span class="math notranslate nohighlight">\(b\)</span>, and <span class="math notranslate nohighlight">\(c\)</span> in rating equation.  Will probably work in log-space so the optimization is OLS.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Objective function to minimize R-squared</span>
<span class="k">def</span> <span class="nf">objective_function</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">df_rating</span><span class="p">,</span> <span class="n">equation_func</span><span class="p">):</span>
    <span class="n">predicted_gage_height</span> <span class="o">=</span> <span class="n">equation_func</span><span class="p">(</span><span class="n">df_rating</span><span class="p">[</span><span class="s1">&#39;Discharge&#39;</span><span class="p">],</span> <span class="o">*</span><span class="n">params</span><span class="p">)</span>
    <span class="n">ss_residuals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">df_rating</span><span class="p">[</span><span class="s1">&#39;Gage Height&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">predicted_gage_height</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ss_total</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">df_rating</span><span class="p">[</span><span class="s1">&#39;Gage Height&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">df_rating</span><span class="p">[</span><span class="s1">&#39;Gage Height&#39;</span><span class="p">]))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="c1"># Check if ss_total is close to zero</span>
    <span class="k">if</span> <span class="n">ss_total</span> <span class="o">&lt;</span> <span class="mf">1e-10</span><span class="p">:</span>  <span class="c1"># Adjust threshold as needed</span>
        <span class="k">return</span> <span class="o">-</span><span class="mf">1e10</span>      <span class="c1"># Return a large negative value to discourage such solutions</span>
    
    <span class="n">r_squared</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">ss_residuals</span> <span class="o">/</span> <span class="n">ss_total</span><span class="p">)</span>
    <span class="k">return</span> <span class="o">-</span><span class="n">r_squared</span>      <span class="c1"># Minimize negative R-squared</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The fitting method - in this case Nelder-Mead downhill simplex method.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#------------------------------------------------------------------------</span>
<span class="c1"># Fit the equation using minimization of residuals</span>
<span class="k">def</span> <span class="nf">fit_rating_curve</span><span class="p">(</span><span class="n">df_rating</span><span class="p">):</span>
    <span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># Initial guess for parameters [a, b, c]</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="n">objective_function</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">df_rating</span><span class="p">,</span> <span class="n">rating_equation</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;Nelder-Mead&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">res</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
        <span class="c1"># Calculate predicted gage heights</span>
        <span class="n">predicted_gage_heights</span> <span class="o">=</span> <span class="n">rating_equation</span><span class="p">(</span><span class="n">df_rating</span><span class="p">[</span><span class="s1">&#39;Discharge&#39;</span><span class="p">],</span> <span class="o">*</span><span class="n">res</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
        
        <span class="c1"># Calculate R-squared</span>
        <span class="n">r_squared</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">df_rating</span><span class="p">[</span><span class="s1">&#39;Gage Height&#39;</span><span class="p">],</span> <span class="n">predicted_gage_heights</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">res</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">r_squared</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Fitting failed:&quot;</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>  <span class="c1"># Print out the error message</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Plotting the fitted curve</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the fitting rating curve</span>
<span class="k">def</span> <span class="nf">plot_fitted_curve</span><span class="p">(</span><span class="n">df_rating</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">r_squared</span><span class="p">):</span>
    <span class="c1"># Define colors for scatter and curve</span>
    <span class="n">scatter_color</span> <span class="o">=</span> <span class="s1">&#39;steelblue&#39;</span>
    <span class="n">curve_color</span> <span class="o">=</span> <span class="s1">&#39;darkorange&#39;</span>

    <span class="c1"># Create figure and axis objects</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    
    <span class="c1"># Plot original data as scatter points</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df_rating</span><span class="p">[</span><span class="s1">&#39;Discharge&#39;</span><span class="p">],</span> <span class="n">df_rating</span><span class="p">[</span><span class="s1">&#39;Gage Height&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Original data&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">scatter_color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

    <span class="c1"># Generate fitted curve</span>
    <span class="n">Q_fit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">df_rating</span><span class="p">[</span><span class="s1">&#39;Discharge&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">df_rating</span><span class="p">[</span><span class="s1">&#39;Discharge&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">100</span><span class="p">)</span>
    <span class="n">fitted_curve</span> <span class="o">=</span> <span class="n">rating_equation</span><span class="p">(</span><span class="n">Q_fit</span><span class="p">,</span> <span class="o">*</span><span class="n">params</span><span class="p">)</span>
    
    <span class="c1"># Plot fitted curve</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Q_fit</span><span class="p">,</span> <span class="n">fitted_curve</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Fitted curve: $H(Q) = a \cdot Q^b + </span><span class="se">\\</span><span class="s1">frac</span><span class="se">{{</span><span class="s1">1</span><span class="se">}}{{</span><span class="s1">c</span><span class="se">}}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">curve_color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="c1"># Add equation and R-squared value as text box</span>
    <span class="n">equation_text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;$H(Q) = </span><span class="si">{</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> \cdot Q^</span><span class="se">{{</span><span class="si">{</span><span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="se">}}</span><span class="si">}</span><span class="s2"> + </span><span class="se">\\</span><span class="s2">frac</span><span class="se">{{</span><span class="s2">1</span><span class="se">}}{{</span><span class="si">{</span><span class="n">params</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="se">}}</span><span class="si">}</span><span class="s2">$&quot;</span>
    <span class="n">r_squared_text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;$R^2 = </span><span class="si">{</span><span class="n">r_squared</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">$&quot;</span>
    <span class="n">text_box_content</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">equation_text</span><span class="si">}</span><span class="se">\n\n</span><span class="si">{</span><span class="n">r_squared_text</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.55</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">,</span> <span class="n">text_box_content</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">))</span>

    <span class="c1"># Set labels and title</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Discharge $(ft^3/s)$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Gage Height $(ft)$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Fitted Rating Curve&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    
    <span class="c1"># Add grid</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Add legend</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

    <span class="c1"># Adjust layout</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

    <span class="c1"># Save plot as PNG file</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">station_code</span><span class="si">}</span><span class="s1">fitted_rating_curve.png&#39;</span><span class="p">)</span>

    <span class="c1"># Show plot</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The supervisory script (aka Learn Dammit!)</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Main function to operate the script</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">station_code</span><span class="p">):</span>
    <span class="c1"># Step 1: Retrieve and clean data</span>
    <span class="n">df_rating</span> <span class="o">=</span> <span class="n">retrieve_rating_curve_data</span><span class="p">(</span><span class="n">station_code</span><span class="p">)</span>
    
    <span class="c1"># Step 2: Plot original data</span>
    <span class="n">plot_original_data</span><span class="p">(</span><span class="n">df_rating</span><span class="p">)</span>
    
    <span class="c1"># Step 3: Fit the curve</span>
    <span class="n">params</span><span class="p">,</span> <span class="n">r_squared</span> <span class="o">=</span> <span class="n">fit_rating_curve</span><span class="p">(</span><span class="n">df_rating</span><span class="p">)</span>
    
    <span class="c1"># Step 4: Plot the fitted curve</span>
    <span class="k">if</span> <span class="n">params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plot_fitted_curve</span><span class="p">(</span><span class="n">df_rating</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">r_squared</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Fitting failed. Unable to plot the fitted curve.&quot;</span><span class="p">)</span>

<span class="c1">#--------------------------------------------------------------------------</span>
<span class="c1">#           Call the main function by the station code</span>
<span class="c1">#--------------------------------------------------------------------------</span>
<span class="n">main</span><span class="p">(</span><span class="n">station_code</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/automated_data_50_0.png" src="../../_images/automated_data_50_0.png" />
<img alt="../../_images/automated_data_50_1.png" src="../../_images/automated_data_50_1.png" />
</div>
</div>
</div>
<div class="section" id="references">
<h3>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>U.S. Geological Survey. (1996). <em>Data from Selected U.S. Geological Survey National Stream Water-Quality Monitoring Networks (WQN) on CD-ROM</em>. Retrieved from <a class="reference external" href="https://pubs.usgs.gov/dds/wqn96cd/">https://pubs.usgs.gov/dds/wqn96cd/</a> on 11/29/2023.</p></li>
<li><p>Vogel, R. M., &amp; Fennessey, N. M. (1995). Flow duration curves II: a review of applications in water resources planning. <em>JAWRA Journal of the American Water Resources Association</em>, 31(6), 1029-1039.</p></li>
<li><p>Bedient, P. B. (2002). <em>Hydrologic and Floodplain Analysis</em>. Prentice Hall, Upper Saddle River, New Jersey 07458.</p></li>
<li><p>HydroMohsen. (2022). <em>Download and Visualize Daily Streamflow Data from USGS Using Python</em>. Retrieved from <a class="reference external" href="https://www.youtube.com/watch?v=fs5BOUn8zvw">https://www.youtube.com/watch?v=fs5BOUn8zvw</a> on 2023-03-15.</p></li>
<li><p>Mohsen Tahmasebi Nasab. (2022). <em>Download and Visualize Daily Streamflow Data from USGS Using Python</em>. Retrieved from <a class="reference external" href="https://colab.research.google.com/drive/1OqjB1UbUH8KwJEIG6qMCfdfJtLev5kph?usp=sharing">https://colab.research.google.com/drive/1OqjB1UbUH8KwJEIG6qMCfdfJtLev5kph?usp=sharing</a> on 2023-03-15.</p></li>
<li><p>OpenAI. (2022). <em>ChatGPT: Conversational AI Model</em>. Version 3.5. Retrieved from <a class="reference external" href="https://openai.com/chatgpt">https://openai.com/chatgpt</a> on February 21, 2024.
03-15.</p></li>
</ul>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./lessons/06.1streamflow"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="../06streamflow/streamflowdata.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title">Streamflow Data Modeling</p>
            </div>
        </a>
    </div>
     <div id="next">
        <a class="right-next" href="../07runoffmechanisms/runoffmechanisms.html" title="next page">
            <div class="prevnext-info">
                <p class="prevnext-label">next</p>
                <p class="prevnext-title">7. Surface-Runoff Mechanics</p>
            </div>
            <i class="prevnext-label fas fa-angle-right"></i>
        </a>
     </div>

</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Theodore G. Cleveland, Ph.D., P.E., M.ASCE, F.EWRI<br/>
        
            &copy; Copyright 2024.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>